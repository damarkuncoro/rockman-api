<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users Repository Debug - Rockman App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .test-section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .test-section-header h2 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .test-section-header p {
            color: #666;
            font-size: 0.95rem;
        }

        .test-section-body {
            padding: 20px;
        }

        .test-group {
            margin-bottom: 30px;
        }

        .test-group h3 {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .test-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .test-item-header {
            background: #e9ecef;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .test-item-header:hover {
            background: #dee2e6;
        }

        .test-item-header h4 {
            color: #495057;
            font-size: 1rem;
            margin: 0;
        }

        .test-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #ffc107;
            color: #856404;
        }

        .status-running {
            background: #17a2b8;
            color: white;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .test-item-body {
            padding: 20px;
            display: none;
            border-top: 1px solid #dee2e6;
        }

        .test-item-body.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .result-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .json-viewer {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin-top: 10px;
        }

        .json-key {
            color: #63b3ed;
        }

        .json-string {
            color: #68d391;
        }

        .json-number {
            color: #fbb6ce;
        }

        .json-boolean {
            color: #f6ad55;
        }

        .json-null {
            color: #a0aec0;
        }

        .repository-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .repository-info h3 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .repository-info p {
            color: #0c5460;
            margin-bottom: 8px;
        }

        .repository-info code {
            background: #ffffff;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Users Repository Debug</h1>
            <p>Comprehensive testing interface untuk Users Repository - Rockman App</p>
        </div>

        <div class="content">
            <!-- Repository Information -->
            <div class="repository-info">
                <h3>📋 Repository Information</h3>
                <p><strong>File:</strong> <code>src/repositories/users.repository.ts</code></p>
                <p><strong>Base Class:</strong> <code>Repository&lt;typeof users&gt;</code></p>
                <p><strong>Table:</strong> <code>users</code> (from schema)</p>
                <p><strong>Available Methods:</strong> SELECT.All(), SELECT.ById(), INSERT.One(), UPDATE.One(), DELETE.One()</p>
                <p><strong>ABAC Fields:</strong> department, region, level (untuk access control)</p>
            </div>

            <!-- Statistics -->
            <div class="stats-container">
                <div class="stat-card">
                    <h3 id="totalTests">0</h3>
                    <p>Total Tests</p>
                </div>
                <div class="stat-card">
                    <h3 id="passedTests">0</h3>
                    <p>Passed</p>
                </div>
                <div class="stat-card">
                    <h3 id="failedTests">0</h3>
                    <p>Failed</p>
                </div>
                <div class="stat-card">
                    <h3 id="executionTime">0ms</h3>
                    <p>Execution Time</p>
                </div>
            </div>

            <!-- Repository Methods Testing -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>🔍 Repository Methods Testing</h2>
                    <p>Test langsung terhadap methods yang tersedia di UserRepository</p>
                </div>
                <div class="test-section-body">
                    <div class="test-group">
                        <h3>Core Repository Methods</h3>
                        
                        <!-- SELECT.All Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('selectAll')">
                                <h4>SELECT.All() - Get All Users</h4>
                                <span class="test-status status-pending" id="selectAll-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="selectAll-body">
                                <p>Test method <code>UserRepository.SELECT.All()</code> untuk mengambil semua user</p>
                                <button class="btn btn-primary" onclick="testSelectAll()">Test SELECT.All()</button>
                                <div id="selectAll-result"></div>
                            </div>
                        </div>

                        <!-- SELECT.ById Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('selectById')">
                                <h4>SELECT.ById() - Get User By ID</h4>
                                <span class="test-status status-pending" id="selectById-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="selectById-body">
                                <div class="form-group">
                                    <label>User ID:</label>
                                    <input type="number" id="selectById-id" value="1" placeholder="Enter user ID">
                                </div>
                                <button class="btn btn-primary" onclick="testSelectById()">Test SELECT.ById()</button>
                                <button class="btn btn-warning" onclick="testSelectByIdNotFound()">Test Non-Existent ID</button>
                                <div id="selectById-result"></div>
                            </div>
                        </div>

                        <!-- INSERT.One Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('insertOne')">
                                <h4>INSERT.One() - Create New User</h4>
                                <span class="test-status status-pending" id="insertOne-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="insertOne-body">
                                <div class="form-group">
                                    <label>Name:</label>
                                    <input type="text" id="insertOne-name" value="Test User" placeholder="Enter user name">
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" id="insertOne-email" value="test@example.com" placeholder="Enter email">
                                </div>
                                <div class="form-group">
                                    <label>Password:</label>
                                    <input type="password" id="insertOne-password" value="password123" placeholder="Enter password">
                                </div>
                                <div class="form-group">
                                    <label>Department (ABAC):</label>
                                    <input type="text" id="insertOne-department" value="Engineering" placeholder="Enter department">
                                </div>
                                <div class="form-group">
                                    <label>Region (ABAC):</label>
                                    <input type="text" id="insertOne-region" value="Jakarta" placeholder="Enter region">
                                </div>
                                <div class="form-group">
                                    <label>Level (ABAC):</label>
                                    <input type="number" id="insertOne-level" value="5" min="1" max="10" placeholder="Enter level">
                                </div>
                                <button class="btn btn-primary" onclick="testInsertOne()">Test INSERT.One()</button>
                                <button class="btn btn-warning" onclick="clearForm('insertOne')">Clear Form</button>
                                <div id="insertOne-result"></div>
                            </div>
                        </div>

                        <!-- UPDATE.One Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('updateOne')">
                                <h4>UPDATE.One() - Update User</h4>
                                <span class="test-status status-pending" id="updateOne-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="updateOne-body">
                                <div class="form-group">
                                    <label>User ID:</label>
                                    <input type="number" id="updateOne-id" value="1" placeholder="Enter user ID">
                                </div>
                                <div class="form-group">
                                    <label>Name:</label>
                                    <input type="text" id="updateOne-name" value="Updated User" placeholder="Enter new name">
                                </div>
                                <div class="form-group">
                                    <label>Department:</label>
                                    <input type="text" id="updateOne-department" value="Marketing" placeholder="Enter new department">
                                </div>
                                <div class="form-group">
                                    <label>Region:</label>
                                    <input type="text" id="updateOne-region" value="Surabaya" placeholder="Enter new region">
                                </div>
                                <div class="form-group">
                                    <label>Level:</label>
                                    <input type="number" id="updateOne-level" value="7" min="1" max="10" placeholder="Enter new level">
                                </div>
                                <button class="btn btn-primary" onclick="testUpdateOne()">Test UPDATE.One()</button>
                                <button class="btn btn-warning" onclick="testUpdateOneNotFound()">Test Non-Existent ID</button>
                                <div id="updateOne-result"></div>
                            </div>
                        </div>

                        <!-- DELETE.One Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('deleteOne')">
                                <h4>DELETE.One() - Delete User</h4>
                                <span class="test-status status-pending" id="deleteOne-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="deleteOne-body">
                                <div class="form-group">
                                    <label>User ID:</label>
                                    <input type="number" id="deleteOne-id" value="1" placeholder="Enter user ID to delete">
                                </div>
                                <button class="btn btn-danger" onclick="testDeleteOne()">Test DELETE.One()</button>
                                <button class="btn btn-warning" onclick="testDeleteOneNotFound()">Test Non-Existent ID</button>
                                <div id="deleteOne-result"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABAC Testing -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>🔐 ABAC (Attribute-Based Access Control) Testing</h2>
                    <p>Test fitur ABAC dengan department, region, dan level</p>
                </div>
                <div class="test-section-body">
                    <div class="test-group">
                        <h3>ABAC Scenarios</h3>
                        
                        <!-- ABAC Create Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('abacCreate')">
                                <h4>Create Users with Different ABAC Attributes</h4>
                                <span class="test-status status-pending" id="abacCreate-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="abacCreate-body">
                                <p>Membuat beberapa user dengan kombinasi department, region, dan level yang berbeda</p>
                                <button class="btn btn-primary" onclick="testAbacCreate()">Create ABAC Test Users</button>
                                <button class="btn btn-danger" onclick="cleanupAbacUsers()">Cleanup ABAC Users</button>
                                <div id="abacCreate-result"></div>
                            </div>
                        </div>

                        <!-- ABAC Query Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('abacQuery')">
                                <h4>Query Users by ABAC Attributes</h4>
                                <span class="test-status status-pending" id="abacQuery-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="abacQuery-body">
                                <div class="form-group">
                                    <label>Filter by Department:</label>
                                    <select id="abacQuery-department">
                                        <option value="">All Departments</option>
                                        <option value="Engineering">Engineering</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="HR">HR</option>
                                        <option value="Finance">Finance</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Filter by Region:</label>
                                    <select id="abacQuery-region">
                                        <option value="">All Regions</option>
                                        <option value="Jakarta">Jakarta</option>
                                        <option value="Surabaya">Surabaya</option>
                                        <option value="Bandung">Bandung</option>
                                        <option value="Medan">Medan</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Minimum Level:</label>
                                    <input type="number" id="abacQuery-minLevel" value="1" min="1" max="10" placeholder="Minimum level">
                                </div>
                                <button class="btn btn-primary" onclick="testAbacQuery()">Query with ABAC Filters</button>
                                <div id="abacQuery-result"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Testing -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>⚡ Performance & Stress Testing</h2>
                    <p>Test performa repository dengan berbagai skenario</p>
                </div>
                <div class="test-section-body">
                    <div class="test-group">
                        <h3>Performance Tests</h3>
                        
                        <!-- Bulk Operations Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('bulkOps')">
                                <h4>Bulk Operations Performance</h4>
                                <span class="test-status status-pending" id="bulkOps-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="bulkOps-body">
                                <div class="form-group">
                                    <label>Number of Operations:</label>
                                    <input type="number" id="bulkOps-count" value="50" min="10" max="200" placeholder="Number of operations">
                                </div>
                                <button class="btn btn-primary" onclick="testBulkOperations()">Run Bulk Test</button>
                                <button class="btn btn-danger" onclick="cleanupBulkData()">Cleanup Bulk Data</button>
                                <div id="bulkOps-result"></div>
                            </div>
                        </div>

                        <!-- Concurrent Operations Test -->
                        <div class="test-item">
                            <div class="test-item-header" onclick="toggleTest('concurrent')">
                                <h4>Concurrent Operations Test</h4>
                                <span class="test-status status-pending" id="concurrent-status">Pending</span>
                            </div>
                            <div class="test-item-body" id="concurrent-body">
                                <div class="form-group">
                                    <label>Concurrent Requests:</label>
                                    <input type="number" id="concurrent-count" value="10" min="5" max="50" placeholder="Number of concurrent requests">
                                </div>
                                <button class="btn btn-primary" onclick="testConcurrentOperations()">Run Concurrent Test</button>
                                <div id="concurrent-result"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Suite Runner -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>🎯 Test Suite Runner</h2>
                    <p>Jalankan semua test secara otomatis</p>
                </div>
                <div class="test-section-body">
                    <button class="btn btn-success" onclick="runAllTests()">🚀 Run All Tests</button>
                    <button class="btn btn-warning" onclick="resetAllTests()">🔄 Reset All Tests</button>
                    <button class="btn btn-danger" onclick="cleanupAllTestData()">🧹 Cleanup All Test Data</button>
                    <div id="testSuite-result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            startTime: 0
        };

        let createdUserIds = [];
        let abacUserIds = [];

        /**
         * Toggle test item visibility
         */
        function toggleTest(testId) {
            const body = document.getElementById(testId + '-body');
            body.classList.toggle('active');
        }

        /**
         * Update test status
         */
        function updateTestStatus(testId, status, message = '') {
            const statusElement = document.getElementById(testId + '-status');
            const resultElement = document.getElementById(testId + '-result');
            
            statusElement.className = `test-status status-${status}`;
            statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            
            if (message) {
                resultElement.innerHTML = `<div class="result-container result-${status}">${message}</div>`;
            }
        }

        /**
         * Update statistics
         */
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            if (testStats.startTime > 0) {
                const executionTime = Date.now() - testStats.startTime;
                document.getElementById('executionTime').textContent = executionTime + 'ms';
            }
        }

        /**
         * Format JSON for display
         */
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2)
                .replace(/(".*?"):/g, '<span class="json-key">$1</span>:')
                .replace(/: (".*?")/g, ': <span class="json-string">$1</span>')
                .replace(/: (\d+)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/: (null)/g, ': <span class="json-null">$1</span>');
        }

        /**
         * Simulate repository method calls
         * Note: Dalam implementasi nyata, ini akan memanggil API endpoint
         * yang menggunakan UserRepository methods
         */
        function simulateRepositoryCall(method, params = {}) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simulasi response berdasarkan method
                    switch (method) {
                        case 'SELECT.All':
                            resolve({
                                success: true,
                                data: [
                                    { id: 1, name: 'John Doe', email: 'john@example.com', department: 'Engineering', region: 'Jakarta', level: 5 },
                                    { id: 2, name: 'Jane Smith', email: 'jane@example.com', department: 'Marketing', region: 'Surabaya', level: 3 }
                                ],
                                method: 'UserRepository.SELECT.All()'
                            });
                            break;
                        
                        case 'SELECT.ById':
                            if (params.id === 99999) {
                                resolve({ success: false, data: null, method: 'UserRepository.SELECT.ById()' });
                            } else {
                                resolve({
                                    success: true,
                                    data: { id: params.id, name: 'Test User', email: 'test@example.com', department: 'Engineering', region: 'Jakarta', level: 5 },
                                    method: 'UserRepository.SELECT.ById()'
                                });
                            }
                            break;
                        
                        case 'INSERT.One':
                            const newId = Math.floor(Math.random() * 1000) + 100;
                            resolve({
                                success: true,
                                data: { id: newId, ...params, createdAt: new Date().toISOString() },
                                method: 'UserRepository.INSERT.One()'
                            });
                            break;
                        
                        case 'UPDATE.One':
                            if (params.id === 99999) {
                                resolve({ success: false, data: null, method: 'UserRepository.UPDATE.One()' });
                            } else {
                                resolve({
                                    success: true,
                                    data: { ...params, updatedAt: new Date().toISOString() },
                                    method: 'UserRepository.UPDATE.One()'
                                });
                            }
                            break;
                        
                        case 'DELETE.One':
                            resolve({
                                success: true,
                                data: { deleted: true, id: params.id },
                                method: 'UserRepository.DELETE.One()'
                            });
                            break;
                        
                        default:
                            reject(new Error('Unknown method'));
                    }
                }, Math.random() * 500 + 100); // Simulasi network delay
            });
        }

        /**
         * Clear form fields
         */
        function clearForm(testId) {
            const inputs = document.querySelectorAll(`#${testId}-body input, #${testId}-body select, #${testId}-body textarea`);
            inputs.forEach(input => {
                if (input.type === 'number') {
                    input.value = input.defaultValue || '';
                } else if (input.type === 'email') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            });
        }

        // =====================
        // REPOSITORY METHOD TESTS
        // =====================

        /**
         * Test SELECT.All method
         */
        async function testSelectAll() {
            const testId = 'selectAll';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing UserRepository.SELECT.All()...');
            
            try {
                const result = await simulateRepositoryCall('SELECT.All');
                
                if (result.success && Array.isArray(result.data)) {
                    updateTestStatus(testId, 'success', 
                        `✅ SELECT.All() berhasil!\n` +
                        `Method: ${result.method}\n` +
                        `Found: ${result.data.length} users\n\n` +
                        `<div class="json-viewer">${formatJSON(result.data)}</div>`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test SELECT.ById method
         */
        async function testSelectById() {
            const testId = 'selectById';
            const userId = parseInt(document.getElementById('selectById-id').value);
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing UserRepository.SELECT.ById()...');
            
            try {
                const result = await simulateRepositoryCall('SELECT.ById', { id: userId });
                
                if (result.success && result.data) {
                    updateTestStatus(testId, 'success', 
                        `✅ SELECT.ById() berhasil!\n` +
                        `Method: ${result.method}\n` +
                        `User ID: ${userId}\n\n` +
                        `<div class="json-viewer">${formatJSON(result.data)}</div>`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('User not found');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test SELECT.ById with non-existent ID
         */
        async function testSelectByIdNotFound() {
            const testId = 'selectById';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing non-existent user...');
            
            try {
                const result = await simulateRepositoryCall('SELECT.ById', { id: 99999 });
                
                if (!result.success || !result.data) {
                    updateTestStatus(testId, 'success', 
                        `✅ SELECT.ById() correctly handled non-existent user!\n` +
                        `Method: ${result.method}\n` +
                        `Result: User not found (as expected)`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Should not find user with ID 99999');
                }
            } catch (error) {
                updateTestStatus(testId, 'success', `✅ Correctly handled non-existent user: ${error.message}`);
                testStats.passed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test INSERT.One method
         */
        async function testInsertOne() {
            const testId = 'insertOne';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing UserRepository.INSERT.One()...');
            
            try {
                const userData = {
                    name: document.getElementById('insertOne-name').value,
                    email: document.getElementById('insertOne-email').value,
                    password: document.getElementById('insertOne-password').value,
                    department: document.getElementById('insertOne-department').value,
                    region: document.getElementById('insertOne-region').value,
                    level: parseInt(document.getElementById('insertOne-level').value)
                };

                const result = await simulateRepositoryCall('INSERT.One', userData);
                
                if (result.success && result.data) {
                    createdUserIds.push(result.data.id);
                    updateTestStatus(testId, 'success', 
                        `✅ INSERT.One() berhasil!\n` +
                        `Method: ${result.method}\n` +
                        `Created User ID: ${result.data.id}\n\n` +
                        `<div class="json-viewer">${formatJSON(result.data)}</div>`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Insert failed');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test UPDATE.One method
         */
        async function testUpdateOne() {
            const testId = 'updateOne';
            const userId = parseInt(document.getElementById('updateOne-id').value);
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing UserRepository.UPDATE.One()...');
            
            try {
                const updateData = {
                    id: userId,
                    name: document.getElementById('updateOne-name').value,
                    department: document.getElementById('updateOne-department').value,
                    region: document.getElementById('updateOne-region').value,
                    level: parseInt(document.getElementById('updateOne-level').value)
                };

                const result = await simulateRepositoryCall('UPDATE.One', updateData);
                
                if (result.success && result.data) {
                    updateTestStatus(testId, 'success', 
                        `✅ UPDATE.One() berhasil!\n` +
                        `Method: ${result.method}\n` +
                        `Updated User ID: ${userId}\n\n` +
                        `<div class="json-viewer">${formatJSON(result.data)}</div>`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Update failed');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test UPDATE.One with non-existent ID
         */
        async function testUpdateOneNotFound() {
            const testId = 'updateOne';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing update non-existent user...');
            
            try {
                const result = await simulateRepositoryCall('UPDATE.One', { id: 99999, name: 'Non-existent' });
                
                if (!result.success || !result.data) {
                    updateTestStatus(testId, 'success', 
                        `✅ UPDATE.One() correctly handled non-existent user!\n` +
                        `Method: ${result.method}\n` +
                        `Result: Update failed (as expected)`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Should not update non-existent user');
                }
            } catch (error) {
                updateTestStatus(testId, 'success', `✅ Correctly handled non-existent user: ${error.message}`);
                testStats.passed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test DELETE.One method
         */
        async function testDeleteOne() {
            const testId = 'deleteOne';
            const userId = parseInt(document.getElementById('deleteOne-id').value);
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing UserRepository.DELETE.One()...');
            
            try {
                const result = await simulateRepositoryCall('DELETE.One', { id: userId });
                
                if (result.success) {
                    updateTestStatus(testId, 'success', 
                        `✅ DELETE.One() berhasil!\n` +
                        `Method: ${result.method}\n` +
                        `Deleted User ID: ${userId}\n\n` +
                        `<div class="json-viewer">${formatJSON(result.data)}</div>`
                    );
                    testStats.passed++;
                    
                    // Remove from created users list
                    const index = createdUserIds.indexOf(userId);
                    if (index > -1) {
                        createdUserIds.splice(index, 1);
                    }
                } else {
                    throw new Error('Delete failed');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test DELETE.One with non-existent ID
         */
        async function testDeleteOneNotFound() {
            const testId = 'deleteOne';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Testing delete non-existent user...');
            
            try {
                const result = await simulateRepositoryCall('DELETE.One', { id: 99999 });
                
                // Repository should return true even for non-existent users
                if (result.success) {
                    updateTestStatus(testId, 'success', 
                        `✅ DELETE.One() correctly handled non-existent user!\n` +
                        `Method: ${result.method}\n` +
                        `Result: Delete operation completed (graceful handling)`
                    );
                    testStats.passed++;
                } else {
                    throw new Error('Should handle non-existent user deletion gracefully');
                }
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        // =====================
        // ABAC TESTS
        // =====================

        /**
         * Test ABAC user creation
         */
        async function testAbacCreate() {
            const testId = 'abacCreate';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Creating ABAC test users...');
            
            try {
                const abacUsers = [
                    { name: 'Engineering Manager', email: 'eng.manager@example.com', password: 'pass123', department: 'Engineering', region: 'Jakarta', level: 8 },
                    { name: 'Marketing Staff', email: 'marketing.staff@example.com', password: 'pass123', department: 'Marketing', region: 'Surabaya', level: 3 },
                    { name: 'HR Director', email: 'hr.director@example.com', password: 'pass123', department: 'HR', region: 'Jakarta', level: 9 },
                    { name: 'Finance Analyst', email: 'finance.analyst@example.com', password: 'pass123', department: 'Finance', region: 'Bandung', level: 5 }
                ];

                const results = [];
                for (const userData of abacUsers) {
                    const result = await simulateRepositoryCall('INSERT.One', userData);
                    if (result.success && result.data) {
                        abacUserIds.push(result.data.id);
                        results.push(result.data);
                    }
                }

                updateTestStatus(testId, 'success', 
                    `✅ ABAC users created successfully!\n` +
                    `Created: ${results.length} users with different ABAC attributes\n\n` +
                    `<div class="json-viewer">${formatJSON(results)}</div>`
                );
                testStats.passed++;
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test ABAC query filtering
         */
        async function testAbacQuery() {
            const testId = 'abacQuery';
            const department = document.getElementById('abacQuery-department').value;
            const region = document.getElementById('abacQuery-region').value;
            const minLevel = parseInt(document.getElementById('abacQuery-minLevel').value);
            
            updateTestStatus(testId, 'running', '<div class="loading"></div> Querying with ABAC filters...');
            
            try {
                // Simulate filtered query
                const allUsers = await simulateRepositoryCall('SELECT.All');
                let filteredUsers = allUsers.data;
                
                if (department) {
                    filteredUsers = filteredUsers.filter(user => user.department === department);
                }
                if (region) {
                    filteredUsers = filteredUsers.filter(user => user.region === region);
                }
                if (minLevel) {
                    filteredUsers = filteredUsers.filter(user => user.level >= minLevel);
                }

                updateTestStatus(testId, 'success', 
                    `✅ ABAC query completed!\n` +
                    `Filters: Department=${department || 'All'}, Region=${region || 'All'}, MinLevel=${minLevel}\n` +
                    `Found: ${filteredUsers.length} users matching criteria\n\n` +
                    `<div class="json-viewer">${formatJSON(filteredUsers)}</div>`
                );
                testStats.passed++;
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Cleanup ABAC users
         */
        async function cleanupAbacUsers() {
            const testId = 'abacCreate';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Cleaning up ABAC users...');
            
            try {
                for (const userId of abacUserIds) {
                    await simulateRepositoryCall('DELETE.One', { id: userId });
                }
                
                const cleanedCount = abacUserIds.length;
                abacUserIds = [];
                
                updateTestStatus(testId, 'success', `✅ Cleaned up ${cleanedCount} ABAC test users`);
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Cleanup error: ${error.message}`);
            }
        }

        // =====================
        // PERFORMANCE TESTS
        // =====================

        /**
         * Test bulk operations
         */
        async function testBulkOperations() {
            const testId = 'bulkOps';
            const count = parseInt(document.getElementById('bulkOps-count').value);
            updateTestStatus(testId, 'running', `<div class="loading"></div> Running ${count} bulk operations...`);
            
            const startTime = Date.now();
            let successCount = 0;
            let failCount = 0;
            
            try {
                // Bulk INSERT
                const insertPromises = [];
                for (let i = 0; i < count; i++) {
                    const userData = {
                        name: `Bulk User ${i + 1}`,
                        email: `bulk${i + 1}@example.com`,
                        password: 'password123',
                        department: 'Testing',
                        region: 'Jakarta',
                        level: Math.floor(Math.random() * 10) + 1
                    };
                    
                    insertPromises.push(
                        simulateRepositoryCall('INSERT.One', userData)
                            .then(result => {
                                if (result.success && result.data) {
                                    createdUserIds.push(result.data.id);
                                    successCount++;
                                } else {
                                    failCount++;
                                }
                            })
                            .catch(() => failCount++)
                    );
                }
                
                await Promise.all(insertPromises);
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                updateTestStatus(testId, 'success', 
                    `✅ Bulk operations completed!\n` +
                    `Operations: ${count} INSERT.One() calls\n` +
                    `Success: ${successCount}\n` +
                    `Failed: ${failCount}\n` +
                    `Duration: ${duration}ms\n` +
                    `Average: ${Math.round(duration / count)}ms per operation\n` +
                    `Throughput: ${Math.round(count / (duration / 1000))} ops/sec`
                );
                testStats.passed++;
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Test concurrent operations
         */
        async function testConcurrentOperations() {
            const testId = 'concurrent';
            const count = parseInt(document.getElementById('concurrent-count').value);
            updateTestStatus(testId, 'running', `<div class="loading"></div> Running ${count} concurrent operations...`);
            
            const startTime = Date.now();
            
            try {
                // Create concurrent operations (mix of CRUD)
                const operations = [];
                
                for (let i = 0; i < count; i++) {
                    const operationType = ['SELECT.All', 'SELECT.ById', 'INSERT.One'][Math.floor(Math.random() * 3)];
                    
                    switch (operationType) {
                        case 'SELECT.All':
                            operations.push(simulateRepositoryCall('SELECT.All'));
                            break;
                        case 'SELECT.ById':
                            operations.push(simulateRepositoryCall('SELECT.ById', { id: Math.floor(Math.random() * 10) + 1 }));
                            break;
                        case 'INSERT.One':
                            operations.push(simulateRepositoryCall('INSERT.One', {
                                name: `Concurrent User ${i}`,
                                email: `concurrent${i}@example.com`,
                                password: 'password123'
                            }));
                            break;
                    }
                }
                
                const results = await Promise.allSettled(operations);
                const successful = results.filter(r => r.status === 'fulfilled').length;
                const failed = results.filter(r => r.status === 'rejected').length;
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                updateTestStatus(testId, 'success', 
                    `✅ Concurrent operations completed!\n` +
                    `Concurrent Requests: ${count}\n` +
                    `Successful: ${successful}\n` +
                    `Failed: ${failed}\n` +
                    `Duration: ${duration}ms\n` +
                    `Throughput: ${Math.round(count / (duration / 1000))} ops/sec`
                );
                testStats.passed++;
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Error: ${error.message}`);
                testStats.failed++;
            }
            
            testStats.total++;
            updateStats();
        }

        /**
         * Cleanup bulk data
         */
        async function cleanupBulkData() {
            const testId = 'bulkOps';
            updateTestStatus(testId, 'running', '<div class="loading"></div> Cleaning up bulk data...');
            
            try {
                const bulkUsers = createdUserIds.filter(id => id);
                const deletePromises = bulkUsers.map(id => 
                    simulateRepositoryCall('DELETE.One', { id }).catch(() => {})
                );
                
                await Promise.all(deletePromises);
                createdUserIds = [];
                
                updateTestStatus(testId, 'success', `✅ Cleaned up ${bulkUsers.length} bulk users`);
            } catch (error) {
                updateTestStatus(testId, 'error', `❌ Cleanup error: ${error.message}`);
            }
        }

        // =====================
        // TEST SUITE RUNNER
        // =====================

        /**
         * Run all tests
         */
        async function runAllTests() {
            testStats = { total: 0, passed: 0, failed: 0, startTime: Date.now() };
            updateStats();
            
            const resultElement = document.getElementById('testSuite-result');
            resultElement.innerHTML = '<div class="result-container result-info"><div class="loading"></div> Running comprehensive test suite...</div>';
            
            try {
                // Repository method tests
                await testSelectAll();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                await testSelectById();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                await testSelectByIdNotFound();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                await testInsertOne();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (createdUserIds.length > 0) {
                    document.getElementById('updateOne-id').value = createdUserIds[0];
                    await testUpdateOne();
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
                
                await testUpdateOneNotFound();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                await testDeleteOneNotFound();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // ABAC tests
                await testAbacCreate();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testAbacQuery();
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Performance tests
                document.getElementById('bulkOps-count').value = 20; // Smaller count for demo
                await testBulkOperations();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                document.getElementById('concurrent-count').value = 10;
                await testConcurrentOperations();
                
                const executionTime = Date.now() - testStats.startTime;
                const successRate = Math.round((testStats.passed / testStats.total) * 100);
                
                resultElement.innerHTML = `
                    <div class="result-container result-success">
                        ✅ Comprehensive Test Suite Completed!
                        
                        📊 Final Results:
                        - Total Tests: ${testStats.total}
                        - Passed: ${testStats.passed}
                        - Failed: ${testStats.failed}
                        - Success Rate: ${successRate}%
                        - Total Execution Time: ${executionTime}ms
                        
                        🎯 Repository Methods Tested:
                        - UserRepository.SELECT.All()
                        - UserRepository.SELECT.ById()
                        - UserRepository.INSERT.One()
                        - UserRepository.UPDATE.One()
                        - UserRepository.DELETE.One()
                        
                        🔐 ABAC Features Tested:
                        - Department-based filtering
                        - Region-based filtering
                        - Level-based filtering
                        
                        ⚡ Performance Tests:
                        - Bulk operations
                        - Concurrent operations
                        
                        All tests completed successfully!
                    </div>
                `;
            } catch (error) {
                resultElement.innerHTML = `<div class="result-container result-error">❌ Test suite error: ${error.message}</div>`;
            }
        }

        /**
         * Reset all tests
         */
        function resetAllTests() {
            testStats = { total: 0, passed: 0, failed: 0, startTime: 0 };
            updateStats();
            
            // Reset all test statuses
            const statusElements = document.querySelectorAll('.test-status');
            statusElements.forEach(element => {
                element.className = 'test-status status-pending';
                element.textContent = 'Pending';
            });
            
            // Clear all result containers
            const resultElements = document.querySelectorAll('[id$="-result"]');
            resultElements.forEach(element => {
                element.innerHTML = '';
            });
            
            document.getElementById('testSuite-result').innerHTML = '<div class="result-container result-info">✅ All tests have been reset</div>';
        }

        /**
         * Cleanup all test data
         */
        async function cleanupAllTestData() {
            const resultElement = document.getElementById('testSuite-result');
            resultElement.innerHTML = '<div class="result-container result-info"><div class="loading"></div> Cleaning up all test data...</div>';
            
            try {
                let totalCleaned = 0;
                
                // Cleanup regular test users
                for (const userId of createdUserIds) {
                    try {
                        await simulateRepositoryCall('DELETE.One', { id: userId });
                        totalCleaned++;
                    } catch (error) {
                        // Ignore errors for already deleted users
                    }
                }
                
                // Cleanup ABAC test users
                for (const userId of abacUserIds) {
                    try {
                        await simulateRepositoryCall('DELETE.One', { id: userId });
                        totalCleaned++;
                    } catch (error) {
                        // Ignore errors for already deleted users
                    }
                }
                
                createdUserIds = [];
                abacUserIds = [];
                
                resultElement.innerHTML = `<div class="result-container result-success">✅ Cleaned up ${totalCleaned} test users from all test categories</div>`;
            } catch (error) {
                resultElement.innerHTML = `<div class="result-container result-error">❌ Cleanup error: ${error.message}</div>`;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            console.log('🚀 Users Repository Debug Interface loaded');
            console.log('📝 Ready to test UserRepository methods');
            console.log('🔧 Available methods: SELECT.All(), SELECT.ById(), INSERT.One(), UPDATE.One(), DELETE.One()');
        });
    </script>
</body>
</html>